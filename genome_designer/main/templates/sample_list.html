{% extends "tab_base.html" %}

{% block content%}
<div class="gd-header h1">
  Samples
</div>

{% if error_string %}
  <div class="alert alert-error alert-block">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    <h4>Error</h4>
    {{ error_string }}
  </div>
{% endif %}

<div id="gd-sample-list-view-datatable-hook" class="container-fluid">
</div>

<!-- Modal -->
<div id="modalFromFile" class="modal hide fade" tabindex="-1" role="dialog">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">×</button>
    <h3 id="modalFromFile">Load Sample Group from Server Location</h3>
  </div>
  <div class="modal-body">
    <ul id="modalFromFileTab" class="nav nav-tabs">
      <li class="active"><a href="#modalFromFile_upload" data-toggle="tab">Upload</a></li>
      <li><a href="#modalFromFile_help" data-toggle="tab">Help</a></li>
    </ul>
    <div id="modalFromFileTabContent" class="tab-content">
      <div class="tab-pane fade in active" id="modalFromFile_upload">
        <p>To load samples from a location on the server, you need to make a <i>targets file</i> that has information about and points to the individual samples.<strong> First download <a href="/templates/sample_list_targets_template.tsv">this template</a></strong>, open it in Excel or a text editor, and fill it in.
        <form id="formFromFile" enctype="multipart/form-data" method="POST">
          {% csrf_token %}
          <input type="file" name="targetsFile" title="Upload Sample Targets File">
        </form> 
      </div>
      <div class="tab-pane fade" id="modalFromFile_help">
        <p>To load samples from a location on the server, you need to make a targets file that has information about and points to the individual samples.<strong> First download <a href="/templates/sample_list_upload_template.tsv">this template</a></strong>, open it in Excel or a text editor, and fill it in.
        </p>
        <i>Required Fields: </i>
        <table class="table table-condensed">
          <tr>
            <td><small><strong>Sample_Name</strong></small></td>
            <td><small>Name for sample. Must be unique, word characters only.</small></td>
          </tr>
            <td><small><strong>Plate_or_Group</strong></small></td>
            <td><small>Name of group or plate from which sample comes. Must be unique. </small></td>
          </tr>
          <tr>
            <td><small><strong>Well</strong></small></td>
            <td><small>Well location on Plate, or short alphanumeric ID for the sample within a group/plate. </small></td>
          </tr>
          <tr>
            <td><small><strong>Read_1_Path</strong></small></td>
            <td><small>Path to FASTQ file for single end reads on the server, or first set of reads for paired end. </small></td>
          </tr>
        </table>
        <i>Optional Fields: </i>
        <table class="table table-condensed">
          <tr>
            <td><small><strong>Read_2_Path</strong></small></td>
            <td><small>Path to FASTQ file for second set of reads for paired end. Blank if single end reads.</small></td>
          </tr>
          <tr>
            <td><small><strong>Parent_Samples</strong></small></td>
            <td><small>Names of sample(s) that are the parents of this sample, comma separated.</small></td>
          </tr>
          <tr>
            <td><small><strong>Other_Fields</strong></small></td>
            <td><small>Add additional fields as needed as additional columns. These can be other string identifiers or numeric metadata like growth rate, escape phenotype (i.e. 0/1), colony color intensity (1-10), etc. Remove this column if not adding metadata.</small></td>
          </tr>
        </table>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal">Cancel</button>
    <button class="btn btn-primary" type="submit" id="submitFormFromFile">Submit</button>
  </div>
</div>

{% if project.is_s3_backed %}
<div id="modalUpload" class="modal hide fade" tabindex="-1" role="dialog">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">×</button>
    <h3 id="modalFromFile">Upload Sample Group to S3</h3>
  </div>
  <div class="modal-body">
    <p>To load samples from a location on the server, you need to make a <i>targets file</i> that has information about and points to the individual samples.<strong> First download <a href="/templates/sample_list_targets_template.tsv">this template</a></strong>, open it in Excel or a text editor, and fill it in.
    <table class="table sample-files-table">
    </table>
    <div id="uploadDiv" data-signature="{% url 's3_signature' %}" data-success="{% url 's3_success' %}" data-delete="{% url 's3_delete' %}" data-parse="{% url 'parse_targets_file_s3' project.uid %}" data-finalize="{% url 'process_sample_files_s3' project.uid %}" data-endpoint="{{ S3_BUCKET }}.s3.amazonaws.com" data-accesskey="{{ AWS_SERVER_PUBLIC_KEY }}"></div>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal">Cancel</button>
    <button class="btn btn-primary" type="submit" id="submitFormFromFile">Submit</button>
  </div>
</div>

<script type="text/template" id="samples-s3-uploader-template">
<div class="qq-uploader-selector qq-uploader">
  <div class="qq-upload-drop-area-selector qq-upload-drop-area" qq-hide-dropzone>
    <span>Drop files here to upload</span>
  </div>
  <div class="qq-upload-button-selector qq-upload-button btn btn-success" style="width: auto;">
    <div><i class="icon-upload icon-white"></i> <span class="qq-choose-file">Choose Template ...</span></div>
  </div>
  <span class="qq-drop-processing-selector qq-drop-processing">
    <span>Processing dropped files...</span>
    <span class="qq-drop-processing-spinner-selector qq-drop-processing-spinner"></span>
  </span>
  <ul class="qq-upload-list-selector qq-upload-list" style="margin-top: 10px; text-align: center;">
    <li>
      <div class="qq-progress-bar-container-selector progress-striped">
          <div class="qq-progress-bar-selector qq-progress-bar bar"></div>
      </div>
      <span class="qq-upload-spinner-selector qq-upload-spinner"></span>
      <span class="qq-upload-file-selector qq-upload-file"></span>
      <span class="qq-upload-size-selector qq-upload-size"></span>
      <a class="qq-upload-cancel-selector qq-upload-cancel" href="#">Cancel</a>
      <span class="qq-upload-status-text-selector qq-upload-status-text"></span>
    </li>
  </ul>
</div>
</script>
{% endif %}

<script type="text/javascript">
  VIEW_TAG = 'SAMPLE';

  {% autoescape off %}
    SAMPLE_LIST_DATA = {{sample_list_json}};
  {% endautoescape %}
</script>
{% endblock %}
